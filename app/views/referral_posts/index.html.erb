<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-tamu-maroon fw-bold">Search Referral Posts</h2>
    <%= link_to "Create Referral Post", new_referral_post_path, class: "tamu-btn tamu-btn-maroon text-decoration-none" %>
  </div>

  <!-- Search Bar -->
  <%= form_with url: referral_posts_path, method: :get, local: true, class: "mb-4" do %>
    <div class="input-group">
      <%= text_field_tag :query, params[:query] || params[:q], placeholder: "Search by company, title, job titleâ€¦", class: "form-control" %>
      <button class="btn btn-outline-maroon" type="submit">Search</button>
    </div>
  <% end %>

  <div class="btn-group mb-3" role="group">
    <%= link_to "All Posts",
      referral_posts_path(query: params[:query] || params[:q], mine: "false"),
        class: "btn btn-outline-primary", style: "#{(params[:mine] == 'false' || params[:mine].blank?) ? 'background-color: #500000 !important; color: #FFFFFF !important;' : 'background-color: #FFFFFF !important; color: #500000 !important;'} border-color: #500000 !important;" %>

    <%= link_to "My Posts",
      referral_posts_path(query: params[:query] || params[:q], mine: "true"),
        class: "btn btn-outline-primary", style: "#{params[:mine] == 'true' ? 'background-color: #500000 !important; color: #FFFFFF !important;' : 'background-color: #FFFFFF !important; color: #500000 !important;'} border-color: #500000 !important;" %>
  </div>

  
  <% @referral_posts.each do |post| %>
    <div class="card shadow-sm mb-3">
      <div class="card-body d-flex flex-row justify-content-between align-items-center">
        <div>
          <h5 class="card-title"><%= post.title %></h5>
          <h6 class="card-subtitle mb-2 text-muted"><%= post.company_name %></h6>
          <p class="card-text">Posted by: <%= post.user.full_name %></p>

          <% request = post.referral_requests.find_by(user: current_user) %>
          <% if request %>
            <h6 class="p-0 mt-1 mb-1">Request Status: <span class="badge bg-secondary"><%= request.status.capitalize %></span></h6>
          <% end %>
        </div>
        <div>
          <% if post.user != current_user && post.active? %>
            <%= link_to "View Post",
              referral_post_path(post),
              class: "tamu-btn tamu-btn-maroon btn-sm" %>
        <% elsif post.user == current_user %>
            <div class="d-flex gap-2 mt-3">
              <%= link_to "Edit", edit_referral_post_path(post), class: "btn btn-outline-secondary" %>
              <%= button_to "Delete", referral_post_path(post), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-outline-danger" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <div class="d-flex justify-content-center mt-4">
    <%= paginate @referral_posts %>
  </div>
</div>