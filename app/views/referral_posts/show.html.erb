<div class="container py-5">
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h3 class="card-title"><%= @referral_post.title %></h3>
      <h5 class="card-subtitle mb-2 text-muted"><%= @referral_post.company_name %> â€” <%= @referral_post.job_title %></h5>

      <p><strong>Location:</strong> <%= @referral_post.location %> |
         <strong>Level:</strong> <%= @referral_post.job_level %> |
         <strong>Type:</strong> <%= @referral_post.employment_type %></p>

      <p class="mb-1"><strong>Why referring:</strong></p>
      <%= simple_format(@referral_post.why_referring) %>

      <% if logged_in? && current_user != @referral_post.user %>
        <!-- Fallback: also present a quick request form -->
        <% request = @referral_post.referral_requests.find_by(user: current_user) %>
        <% if request %>
          <h5 class="mt-4 mb-3 text-center text-tamu-maroon fw-bold">You have already requested a referral for this post.</h5>
          <p class="text-center">Request Status: <span class="badge bg-secondary"><%= request.status.capitalize %></span></p>
        <% else %>
          <% if @referral_post.questions.present? %>
            <h5 class="mt-4 mb-3 text-center text-tamu-maroon fw-bold">Request a Referral Form</h5>
            <%= form_with url: referral_post_referral_requests_path(@referral_post), method: :post, local: true do |f| %>
              <% @referral_post.questions.each_with_index do |q, index| %>
                <div class="mb-2">
                  <label class="form-label"><strong>Q<%= index + 1 %>:</strong> <%= q %></label>
                  <%= text_area_tag "submitted_data[#{q}]", nil, rows: 1, class: "form-control" %>
                </div>
              <% end %>
              <div class="d-flex justify-content-center mt-4"><%= f.submit "Request Referral", class: "tamu-btn tamu-btn-maroon" %></div>
            <% end %>
          <% else %>
            <div class="d-flex justify-content-center">
              <%= button_to "Request Referral",
                    referral_post_referral_requests_path(@referral_post),
                    method: :post,
                    params: { submitted_data: {} },
                    class: "tamu-btn tamu-btn-maroon" %>
            </div>
          <% end %>
        <% end %>
      <% end %>
      
      <% if logged_in? && current_user == @referral_post.user %>
        <div class="d-flex gap-2 mt-3">
          <%= link_to "Edit", edit_referral_post_path(@referral_post), class: "btn btn-outline-secondary" %>
          <%= button_to "Delete", referral_post_path(@referral_post), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-outline-danger" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
