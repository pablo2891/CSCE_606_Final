<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3><%= @conversation.subject || @conversation.other_user(current_user).full_name %></h3>
    <div>
      <%= link_to "Back", conversations_path, class: "btn btn-sm btn-outline-secondary" %>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body" style="max-height: 60vh; overflow-y: auto;">
      <% @messages.each do |m| %>
        <div class="mb-3 <%= m.user == current_user ? 'text-end' : '' %>">
          <div><strong><%= m.user.full_name %></strong></div>
          <div class="p-2 d-inline-block" style="background:#f5f5f5; border-radius:8px; max-width:70%;">
            <%= simple_format(h(m.body)) %>
          </div>
          <div class="small text-muted"><%= m.created_at.strftime("%b %d, %Y %l:%M %p") %></div>
        </div>
      <% end %>
    </div>
  </div>

  <%= form_with model: [@conversation, @message], local: true do |f| %>
    <div class="mb-2">
      <%= f.text_area :body, rows: 3, class: "form-control", placeholder: "Write your message..." %>
    </div>
    <div>
      <%= f.submit "Send", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>
